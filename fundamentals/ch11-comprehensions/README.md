# Chapter 11: æŽ¨å°Žå¼èˆ‡ç”Ÿæˆå™¨ | Comprehensions and Generators

## ðŸ“š ç« ç¯€è³‡è¨Šï¼ˆChapter Informationï¼‰

| é …ç›® | å…§å®¹ |
|:-----|:-----|
| **å­¸ç¿’æ™‚æ•¸** | 3-4 å°æ™‚ |
| **é›£åº¦ç­‰ç´š** | â­â­â­â­â˜† (4/5) - ä¸­é«˜éšŽ |
| **å…ˆå‚™çŸ¥è­˜** | Ch01-10 (è®Šæ•¸ã€é‹ç®—å­ã€æŽ§åˆ¶æµç¨‹ã€åˆ—è¡¨ã€å­—å…¸ã€é›†åˆ) |
| **ç›¸é—œç« ç¯€** | Ch07 åˆ—è¡¨ã€Ch09 å­—å…¸ã€Ch10 é›†åˆã€Ch13 å‡½å¼é€²éšŽ |

---

## ðŸŽ¯ å­¸ç¿’ç›®æ¨™ï¼ˆLearning Objectivesï¼‰

å®Œæˆæœ¬ç« å¾Œï¼Œå­¸ç¿’è€…æ‡‰èƒ½å¤ ï¼š

### çŸ¥è­˜é¢ï¼ˆKnowledgeï¼‰
- **åˆ—å‡º** æŽ¨å°Žå¼çš„ä¸‰ç¨®é¡žåž‹ï¼ˆåˆ—è¡¨ã€å­—å…¸ã€é›†åˆï¼‰
- **å®šç¾©** ç”Ÿæˆå™¨è¡¨é”å¼èˆ‡æƒ°æ€§æ±‚å€¼çš„æ¦‚å¿µ
- **èªªæ˜Ž** æŽ¨å°Žå¼çš„èªžæ³•çµæ§‹èˆ‡åŸ·è¡Œé †åº

### ç†è§£é¢ï¼ˆComprehensionï¼‰
- **è§£é‡‹** æŽ¨å°Žå¼å¦‚ä½•æå‡ç¨‹å¼ç¢¼çš„å¯è®€æ€§èˆ‡æ•ˆèƒ½
- **æ¯”è¼ƒ** æŽ¨å°Žå¼èˆ‡å‚³çµ±è¿´åœˆçš„å·®ç•°
- **æ­¸ç´** ä½•æ™‚æ‡‰ä½¿ç”¨æŽ¨å°Žå¼ã€ä½•æ™‚æ‡‰ä½¿ç”¨å‚³çµ±è¿´åœˆ

### æ‡‰ç”¨é¢ï¼ˆApplicationï¼‰
- **é‹ç”¨** åˆ—è¡¨æŽ¨å°Žå¼å»ºç«‹æ–°åˆ—è¡¨
- **å¯¦ä½œ** å­—å…¸æŽ¨å°Žå¼å»ºç«‹æ˜ å°„é—œä¿‚
- **è§£æ±º** ä½¿ç”¨å·¢ç‹€æŽ¨å°Žå¼è™•ç†å¤šç¶­è³‡æ–™

### åˆ†æžé¢ï¼ˆAnalysisï¼‰
- **åˆ†æž** æŽ¨å°Žå¼çš„å¯è®€æ€§é‚Šç•Œ
- **è¨ºæ–·** è¤‡é›œæŽ¨å°Žå¼çš„æ•ˆèƒ½å•é¡Œ
- **é¸æ“‡** æœ€é©åˆçš„æŽ¨å°Žå¼é¡žåž‹æˆ–ç”Ÿæˆå™¨è¡¨é”å¼

---

## ðŸ”‘ æ ¸å¿ƒæ¦‚å¿µï¼ˆKey Conceptsï¼‰

### æ¦‚å¿µåœ°åœ–
```
æŽ¨å°Žå¼ (Comprehensions)
â”œâ”€â”€ åˆ—è¡¨æŽ¨å°Žå¼ (List Comprehension)
â”‚   â”œâ”€â”€ åŸºæœ¬èªžæ³•: [expr for item in iterable]
â”‚   â”œâ”€â”€ æ¢ä»¶ç¯©é¸: [expr for item in iterable if condition]
â”‚   â”œâ”€â”€ æ¢ä»¶è¡¨é”å¼: [expr1 if condition else expr2 for item in iterable]
â”‚   â””â”€â”€ å·¢ç‹€æŽ¨å°Žå¼: [expr for item1 in iter1 for item2 in iter2]
â”‚
â”œâ”€â”€ å­—å…¸æŽ¨å°Žå¼ (Dict Comprehension)
â”‚   â”œâ”€â”€ åŸºæœ¬èªžæ³•: {key: value for item in iterable}
â”‚   â”œâ”€â”€ æ¢ä»¶ç¯©é¸: {key: value for item in iterable if condition}
â”‚   â””â”€â”€ éµå€¼è½‰æ›: {v: k for k, v in dict.items()}
â”‚
â”œâ”€â”€ é›†åˆæŽ¨å°Žå¼ (Set Comprehension)
â”‚   â”œâ”€â”€ åŸºæœ¬èªžæ³•: {expr for item in iterable}
â”‚   â””â”€â”€ è‡ªå‹•åŽ»é‡: é›†åˆç‰¹æ€§
â”‚
â””â”€â”€ ç”Ÿæˆå™¨è¡¨é”å¼ (Generator Expression)
    â”œâ”€â”€ åŸºæœ¬èªžæ³•: (expr for item in iterable)
    â”œâ”€â”€ æƒ°æ€§æ±‚å€¼: Lazy Evaluation
    â””â”€â”€ è¨˜æ†¶é«”æ•ˆçŽ‡: é©åˆå¤§åž‹è³‡æ–™
```

### First Principles è§£æž

#### ç‚ºä»€éº¼éœ€è¦æŽ¨å°Žå¼ï¼Ÿ

**æ ¹æœ¬å•é¡Œ**ï¼šå‚³çµ±è¿´åœˆçš„å†—é•·æ€§èˆ‡å¯è®€æ€§å•é¡Œ

å‚³çµ±è¿´åœˆå»ºç«‹å¹³æ–¹æ•¸åˆ—è¡¨ï¼š
```python
# å‚³çµ±è¿´åœˆï¼š5 è¡Œç¨‹å¼ç¢¼
squares = []
for i in range(10):
    squares.append(i ** 2)
```

**ç¬¬ä¸€åŽŸç†ï¼šç¨‹å¼è¨­è¨ˆçš„æœ¬è³ªæ˜¯ã€Œè³‡æ–™è½‰æ›ã€**

1. **å‡½æ•¸å¼æ€ç¶­çš„æ ¸å¿ƒ**
   - è¼¸å…¥ï¼šåŽŸå§‹è³‡æ–™é›†åˆ
   - è½‰æ›ï¼šæ˜ å°„å‡½æ•¸ (Mapping Function)
   - ç¯©é¸ï¼šéŽæ¿¾æ¢ä»¶ (Filter Condition)
   - è¼¸å‡ºï¼šæ–°çš„è³‡æ–™é›†åˆ

2. **æŽ¨å°Žå¼çš„å„ªå‹¢**
   - **ç°¡æ½”æ€§**ï¼šå–®è¡Œè¡¨é”å®Œæ•´é‚è¼¯
   - **å¯è®€æ€§**ï¼šèªžç¾©æ›´æŽ¥è¿‘è‡ªç„¶èªžè¨€
   - **æ•ˆèƒ½**ï¼šå…§éƒ¨å„ªåŒ–ï¼ŒåŸ·è¡Œé€Ÿåº¦æ›´å¿«
   - **Pythonic**ï¼šç¬¦åˆ Python è¨­è¨ˆå“²å­¸

**æœ€å°å¯¦ä½œ**ï¼š
```python
# æŽ¨å°Žå¼ï¼š1 è¡Œç¨‹å¼ç¢¼
squares = [i ** 2 for i in range(10)]
```

**æŽ¨å°ŽéŽç¨‹**ï¼š

```python
# æ­¥é©Ÿ 1ï¼šå‚³çµ±è¿´åœˆï¼ˆå‘½ä»¤å¼ç·¨ç¨‹ï¼‰
result = []
for item in iterable:
    result.append(expression)

# æ­¥é©Ÿ 2ï¼šåŸºæœ¬æŽ¨å°Žå¼ï¼ˆè²æ˜Žå¼ç·¨ç¨‹ï¼‰
result = [expression for item in iterable]

# æ­¥é©Ÿ 3ï¼šåŠ å…¥æ¢ä»¶ç¯©é¸
result = [expression for item in iterable if condition]

# æ­¥é©Ÿ 4ï¼šåŠ å…¥æ¢ä»¶è¡¨é”å¼
result = [expr1 if condition else expr2 for item in iterable]
```

**æŽ¨å°Žå¼çš„æœ¬è³ªå…¬å¼**ï¼š
```
æŽ¨å°Žå¼ = è¿´åœˆ + æ˜ å°„ + ç¯©é¸ + æ”¶é›†
```

---

## ðŸ“– é‡è¦è¡“èªžï¼ˆä¸­è‹±å°ç…§ï¼‰

| ä¸­æ–‡ | English | å®šç¾© |
|:-----|:--------|:-----|
| æŽ¨å°Žå¼ | Comprehension | ä»¥ç°¡æ½”èªžæ³•å»ºç«‹é›†åˆçš„è¡¨é”å¼ |
| åˆ—è¡¨æŽ¨å°Žå¼ | List Comprehension | å»ºç«‹åˆ—è¡¨çš„æŽ¨å°Žå¼ |
| å­—å…¸æŽ¨å°Žå¼ | Dict Comprehension | å»ºç«‹å­—å…¸çš„æŽ¨å°Žå¼ |
| é›†åˆæŽ¨å°Žå¼ | Set Comprehension | å»ºç«‹é›†åˆçš„æŽ¨å°Žå¼ |
| ç”Ÿæˆå™¨è¡¨é”å¼ | Generator Expression | è¿”å›žç”Ÿæˆå™¨ç‰©ä»¶çš„è¡¨é”å¼ |
| æƒ°æ€§æ±‚å€¼ | Lazy Evaluation | éœ€è¦æ™‚æ‰è¨ˆç®—å€¼ï¼Œä¸é å…ˆè¨ˆç®—æ‰€æœ‰å€¼ |
| æ˜ å°„ | Mapping | å°‡å‡½æ•¸æ‡‰ç”¨åˆ°é›†åˆçš„æ¯å€‹å…ƒç´  |
| ç¯©é¸ | Filtering | æ ¹æ“šæ¢ä»¶éŽæ¿¾é›†åˆå…ƒç´  |
| å·¢ç‹€æŽ¨å°Žå¼ | Nested Comprehension | åŒ…å«å¤šå±¤è¿´åœˆçš„æŽ¨å°Žå¼ |
| Pythonic | Pythonic | ç¬¦åˆ Python æ…£ç”¨èªžæ³•èˆ‡è¨­è¨ˆå“²å­¸ |

---

## ðŸ“š æ•™æå…§å®¹ï¼ˆCourse Materialsï¼‰

| æª”æ¡ˆ | èªªæ˜Ž | é è¨ˆæ™‚é•· | ä½¿ç”¨æ™‚æ©Ÿ |
|:-----|:-----|:---------|:---------|
| `01-lecture.ipynb` | ðŸ“– ç†è«–è¬›ç¾©èˆ‡ 10+ ç¯„ä¾‹æ¼”ç¤º | 90 åˆ†é˜ | èª²å ‚è¬›æŽˆ |
| `02-worked-examples.ipynb` | ðŸ’¡ 5 å€‹è©³è§£ç¯„ä¾‹ï¼ˆæˆç¸¾ç¯©é¸ã€çŸ©é™£è½‰ç½®ç­‰ï¼‰ | 40 åˆ†é˜ | èª²å ‚æ¼”ç·´ |
| `03-practice.ipynb` | ðŸ› ï¸ 12 é¡Œèª²å ‚ç·´ç¿’ï¼ˆåŸºç¤Žâ†’é€²éšŽâ†’æŒ‘æˆ°ï¼‰ | 40 åˆ†é˜ | éš¨å ‚å¯¦ä½œ |
| `04-exercises.ipynb` | âœï¸ 15 é¡Œèª²å¾Œç¿’é¡Œï¼ˆæ¶µè“‹æ‰€æœ‰æŽ¨å°Žå¼é¡žåž‹ï¼‰ | 120 åˆ†é˜ | èª²å¾Œè‡ªç¿’ |
| `05-solutions.ipynb` | âœ… ç¿’é¡Œå®Œæ•´è§£ç­” | åƒè€ƒç”¨ | è‡ªæˆ‘æª¢æ ¸ |
| `quiz.ipynb` | ðŸ“ 20 é¡Œè‡ªæˆ‘æ¸¬é©—ï¼ˆé¸æ“‡ + ç¨‹å¼é¡Œï¼‰ | 30 åˆ†é˜ | å­¸ç¿’é©—æ”¶ |

---

## ðŸ› ï¸ å¯¦ä½œèƒ½åŠ›æª¢æ ¸ï¼ˆCompetency Checklistï¼‰

å®Œæˆæœ¬ç« å¾Œï¼Œè«‹ç¢ºèªæ‚¨èƒ½å¤ ï¼š

### åŸºæœ¬èƒ½åŠ›
- [ ] å¯«å‡ºåŸºæœ¬çš„åˆ—è¡¨æŽ¨å°Žå¼
- [ ] ç†è§£æŽ¨å°Žå¼çš„èªžæ³•çµæ§‹
- [ ] ä½¿ç”¨ `if` æ¢ä»¶ç¯©é¸å…ƒç´ 
- [ ] å€åˆ†æŽ¨å°Žå¼èˆ‡å‚³çµ±è¿´åœˆçš„å·®ç•°

### é€²éšŽèƒ½åŠ›
- [ ] å¯¦ä½œå­—å…¸æŽ¨å°Žå¼å»ºç«‹æ˜ å°„é—œä¿‚
- [ ] ä½¿ç”¨é›†åˆæŽ¨å°Žå¼åŽ»é™¤é‡è¤‡å…ƒç´ 
- [ ] åœ¨æŽ¨å°Žå¼ä¸­ä½¿ç”¨ `if-else` æ¢ä»¶è¡¨é”å¼
- [ ] å¯¦ä½œå·¢ç‹€æŽ¨å°Žå¼è™•ç†å¤šç¶­è³‡æ–™

### æ‡‰ç”¨èƒ½åŠ›
- [ ] ä½¿ç”¨ç”Ÿæˆå™¨è¡¨é”å¼è™•ç†å¤§åž‹è³‡æ–™
- [ ] è©•ä¼°æŽ¨å°Žå¼çš„å¯è®€æ€§é‚Šç•Œ
- [ ] é¸æ“‡æœ€é©åˆçš„æŽ¨å°Žå¼é¡žåž‹
- [ ] å°‡è¤‡é›œè¿´åœˆæ”¹å¯«ç‚ºæŽ¨å°Žå¼
- [ ] åˆ†æžæŽ¨å°Žå¼èˆ‡è¿´åœˆçš„æ•ˆèƒ½å·®ç•°

---

## ðŸŽ“ æ•™å­¸å»ºè­°ï¼ˆTeaching Tipsï¼‰

### æŽˆèª²è¦é»ž

1. **å¼·èª¿ Pythonic å“²å­¸**
   - "ç°¡æ½”å‹æ–¼è¤‡é›œ" (Simple is better than complex)
   - "å¯è®€æ€§å¾ˆé‡è¦" (Readability counts)
   - æŽ¨å°Žå¼æ˜¯ Python çš„æ ¸å¿ƒç‰¹æ€§ï¼Œæ˜¯é€²éšŽå­¸ç¿’çš„é‡è¦é–€æª»

2. **å¯è®€æ€§ vs ç°¡æ½”æ€§çš„å¹³è¡¡**
   - âœ… å–®å±¤æŽ¨å°Žå¼é€šå¸¸æ˜¯å¥½çš„é¸æ“‡
   - âš ï¸ é›™å±¤æŽ¨å°Žå¼éœ€è¦è¬¹æ…Žä½¿ç”¨
   - âŒ ä¸‰å±¤ä»¥ä¸ŠæŽ¨å°Žå¼å»ºè­°é‡æ§‹ç‚ºå‚³çµ±è¿´åœˆ

3. **å°æ¯”æ•™å­¸æ³•**
   - æ¯å€‹ç¯„ä¾‹éƒ½å±•ç¤ºï¼šå‚³çµ±è¿´åœˆ vs æŽ¨å°Žå¼
   - ä½¿ç”¨ `timeit` æ¨¡çµ„æ¸¬é‡åŸ·è¡Œæ™‚é–“
   - å±•ç¤ºè¨˜æ†¶é«”ä½¿ç”¨å·®ç•°ï¼ˆç”Ÿæˆå™¨ vs åˆ—è¡¨ï¼‰

4. **å¾ªåºæ¼¸é€²**
   - å…ˆæ•™åˆ—è¡¨æŽ¨å°Žå¼ï¼ˆæœ€å¸¸ç”¨ã€æœ€å®¹æ˜“ç†è§£ï¼‰
   - å†æ•™å­—å…¸ã€é›†åˆæŽ¨å°Žå¼
   - æœ€å¾Œä»‹ç´¹ç”Ÿæˆå™¨è¡¨é”å¼ï¼ˆè¼ƒæŠ½è±¡ï¼‰

### å¸¸è¦‹å­¸ç”Ÿå›°é›£é»ž

#### å›°é›£é»ž 1ï¼šæŽ¨å°Žå¼çš„èªžæ³•é †åº
**ç—‡ç‹€**ï¼šå­¸ç”Ÿå®¹æ˜“å°‡ `for` å­å¥æ”¾åœ¨è¡¨é”å¼ä¹‹å‰

```python
# âœ— éŒ¯èª¤å¯«æ³•
[for i in range(10) i**2]

# âœ“ æ­£ç¢ºå¯«æ³•
[i**2 for i in range(10)]
```

**è§£æ±ºæ–¹æ³•**ï¼šå¼·èª¿ã€Œå…ˆèªªåšä»€éº¼ï¼Œå†èªªå¾žå“ªè£¡ä¾†ã€çš„é–±è®€é †åº

#### å›°é›£é»ž 2ï¼šå·¢ç‹€æŽ¨å°Žå¼çš„åŸ·è¡Œé †åº
**ç—‡ç‹€**ï¼šä¸ç†è§£å¤šå±¤ `for` å­å¥çš„åŸ·è¡Œé †åº

```python
# å¤–å±¤è¿´åœˆåœ¨å‰ï¼Œå…§å±¤è¿´åœˆåœ¨å¾Œ
[[i*j for j in range(3)] for i in range(3)]

# ç­‰åŒæ–¼
result = []
for i in range(3):      # å¤–å±¤
    row = []
    for j in range(3):  # å…§å±¤
        row.append(i*j)
    result.append(row)
```

**è§£æ±ºæ–¹æ³•**ï¼šç”¨å‚³çµ±è¿´åœˆå°ç…§ï¼Œå¼·èª¿ã€Œç”±å·¦åˆ°å³ã€çš„åŸ·è¡Œé †åº

#### å›°é›£é»ž 3ï¼šæ¢ä»¶çš„å…©ç¨®ä½ç½®
**ç—‡ç‹€**ï¼šæ··æ·†ç¯©é¸æ¢ä»¶èˆ‡æ¢ä»¶è¡¨é”å¼

```python
# ç¯©é¸æ¢ä»¶ï¼ˆif æ”¾åœ¨æœ€å¾Œï¼‰
[x for x in range(10) if x % 2 == 0]  # åªè¦å¶æ•¸

# æ¢ä»¶è¡¨é”å¼ï¼ˆif-else æ”¾åœ¨æœ€å‰ï¼‰
[x if x % 2 == 0 else 0 for x in range(10)]  # å¥‡æ•¸æ”¹ç‚º 0
```

**è§£æ±ºæ–¹æ³•**ï¼š
- ç¯©é¸æ¢ä»¶ï¼šã€Œé¸æ“‡å“ªäº›å…ƒç´ ã€
- æ¢ä»¶è¡¨é”å¼ï¼šã€Œæ”¹è®Šå…ƒç´ çš„å€¼ã€

#### å›°é›£é»ž 4ï¼šå­—å…¸æŽ¨å°Žå¼èªžæ³•
**ç—‡ç‹€**ï¼šå¿˜è¨˜æä¾›éµå€¼å°

```python
# âœ— éŒ¯èª¤ï¼ˆé€™æ˜¯é›†åˆæŽ¨å°Žå¼ï¼‰
{x**2 for x in range(5)}

# âœ“ æ­£ç¢ºï¼ˆå­—å…¸æŽ¨å°Žå¼éœ€è¦ key: valueï¼‰
{x: x**2 for x in range(5)}
```

**è§£æ±ºæ–¹æ³•**ï¼šå¼·èª¿å­—å…¸éœ€è¦ã€Œå†’è™Ÿã€åˆ†éš”éµå€¼

---

## ðŸ”— å»¶ä¼¸è³‡æºï¼ˆAdditional Resourcesï¼‰

### Python å®˜æ–¹æ–‡ä»¶
- [PEP 202 - List Comprehensions](https://www.python.org/dev/peps/pep-0202/)
- [PEP 274 - Dict Comprehensions](https://www.python.org/dev/peps/pep-0274/)
- [Python Tutorial - List Comprehensions](https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions)
- [Python Tutorial - Generator Expressions](https://docs.python.org/3/reference/expressions.html#generator-expressions)

### æŽ¨è–¦é–±è®€
- [Google Python Style Guide - Comprehensions](https://google.github.io/styleguide/pyguide.html#Comprehensions--Generator-Expressions)
- [The Zen of Python (PEP 20)](https://www.python.org/dev/peps/pep-0020/)
- [Effective Python - Item 27: Prefer List Comprehensions Over map and filter](https://effectivepython.com/)

### é€²éšŽä¸»é¡Œ
- ç”Ÿæˆå™¨å‡½æ•¸ (Generator Functions) èˆ‡ `yield`
- `itertools` æ¨¡çµ„çš„å¼·å¤§åŠŸèƒ½
- å‡½æ•¸å¼ç·¨ç¨‹ (Functional Programming) æ¦‚å¿µ
- `map()`, `filter()`, `reduce()` å‡½æ•¸

---

## ðŸ“ ç‰ˆæœ¬è¨˜éŒ„ï¼ˆVersion Historyï¼‰
- **v1.0** (2025-10-05): åˆç‰ˆç™¼å¸ƒ - å®Œæ•´é–‹ç™¼æ‰€æœ‰ 7 å€‹æª”æ¡ˆ

---

**å­¸ç¿’æé†’**ï¼šæŽ¨å°Žå¼æ˜¯ Python æœ€å…·ä»£è¡¨æ€§çš„ç‰¹æ€§ä¹‹ä¸€ï¼ŒæŽŒæ¡å®ƒä¸åƒ…èƒ½å¯«å‡ºæ›´ç°¡æ½”çš„ç¨‹å¼ç¢¼ï¼Œæ›´é‡è¦çš„æ˜¯åŸ¹é¤Š Pythonic çš„æ€ç¶­æ–¹å¼ã€‚è¨˜ä½ï¼š**æŽ¨å°Žå¼æ˜¯å·¥å…·ï¼Œä¸æ˜¯ç›®çš„**ã€‚ç•¶æŽ¨å°Žå¼è®“ç¨‹å¼ç¢¼æ›´é›£ç†è§£æ™‚ï¼Œä½¿ç”¨å‚³çµ±è¿´åœˆåè€Œæ˜¯æ›´å¥½çš„é¸æ“‡ã€‚

> "Explicit is better than implicit." - The Zen of Python
