# Milestone 05: 銀行帳戶系統 | Banking System

## 🎯 專案目標（Project Objectives）

本專案旨在整合以下章節所學：
- **Chapter 16（類別與物件）**：類別設計、實例化、屬性與方法
- **Chapter 17（封裝與資訊隱藏）**：私有屬性、property 裝飾器、getter/setter
- **Chapter 18（繼承與多型）**：類別繼承、方法覆寫、多型實作
- **Chapter 19（特殊方法與運算子重載）**：魔術方法、運算子重載、物件比較

---

## 📋 專案描述（Project Description）

### 情境說明

您受聘為某銀行的系統開發工程師，需要設計一個完整的帳戶管理系統。這個系統將處理不同類型的銀行帳戶，包括儲蓄帳戶、支票帳戶、定期存款等，並提供完整的金融交易功能。

此專案將深度展示物件導向程式設計的四大支柱：**封裝、繼承、多型、抽象**，並運用 Python 特殊方法實現優雅的 API 設計。

### 功能需求

#### 基本需求（必須完成 - 70分）
1. **帳戶基礎類別**：基本帳戶功能（存款、提款、查詢）
2. **帳戶類型**：儲蓄帳戶、支票帳戶、定期存款帳戶
3. **客戶管理**：客戶資訊與多帳戶管理
4. **交易記錄**：完整的交易歷史追蹤
5. **銀行系統**：帳戶管理與統計功能

#### 進階需求（選做 - 額外30分）
1. **信用卡帳戶**：透支功能與信用額度管理
2. **投資帳戶**：股票買賣與投資組合
3. **帳戶間轉帳**：跨帳戶資金移轉
4. **利息計算**：自動利息計算與派發
5. **風險管理**：交易限制與異常偵測

### 技術規格
- **Python 版本**：3.8+
- **核心技術**：物件導向程式設計、類別繼承、封裝、多型
- **設計模式**：工廠模式、策略模式、觀察者模式
- **預計程式碼行數**：400-600 行（基本需求），800-1200 行（含進階）
- **預計開發時間**：25-35 小時

---

## 🏗️ 專案結構（Project Structure）

```
milestone05-banking-system/
├── README.md              # 專案說明（本文件）
├── requirements.ipynb     # 詳細需求規格與 UML 設計
├── starter-code.ipynb     # 起始程式碼框架與類別模板
└── solution.ipynb         # 完整參考解答與最佳實踐
```

---

## 📚 學習成果（Learning Outcomes）

完成此專案後，您將能夠：

### 知識面（Knowledge）
- **整合運用** Ch16-19 的所有物件導向概念
- **理解** 物件導向設計的四大原則
- **掌握** Python 特殊方法的實際應用

### 技能面（Skills）
- **設計** 完整的類別架構與繼承層次
- **實作** 封裝與資訊隱藏機制
- **運用** 多型實現可擴展的系統
- **應用** 特殊方法建立直觀的 API

### 應用面（Application）
- **解決** 真實世界的複雜業務邏輯
- **建構** 可維護的大型物件導向系統
- **體驗** 企業級軟體開發流程

---

## 🔧 開發步驟建議（Development Guide）

### Phase 1: 系統分析與類別設計（90-120 分鐘）

#### 步驟 1.1: 需求分析（30 分鐘）
1. **仔細閱讀** `requirements.ipynb`，理解完整功能需求
2. **分析業務邏輯**：
   - 銀行帳戶的基本特性（帳號、餘額、持有人）
   - 不同帳戶類型的特殊行為（利率、手續費、限制）
   - 客戶與帳戶的關聯關係
   - 交易記錄的資料結構
3. **識別核心類別**：BankAccount, Customer, Transaction, Bank

#### 步驟 1.2: UML 類別圖設計（45 分鐘）
1. **設計基礎類別架構**：
   ```
   BankAccount (抽象基礎類別)
   ├── SavingsAccount (儲蓄帳戶)
   ├── CheckingAccount (支票帳戶)
   └── TimeDepositAccount (定期存款)
   ```
2. **定義類別關係**：
   - 繼承關係：子類別繼承 BankAccount
   - 組合關係：Customer 擁有多個 Account
   - 聚合關係：Bank 管理多個 Customer 和 Account
3. **規劃方法設計**：基本 CRUD 操作 + 業務邏輯方法

#### 步驟 1.3: 資料結構規劃（30-45 分鐘）
1. **定義核心屬性**：
   - 私有屬性的識別與封裝策略
   - Property 裝飾器的使用時機
   - 類別變數 vs 實例變數的選擇
2. **設計特殊方法**：`__str__`, `__repr__`, `__eq__`, `__lt__` 等
3. **規劃例外處理**：自訂例外類別與錯誤處理策略

### Phase 2: 核心功能實作（180-240 分鐘）

#### 步驟 2.1: 基礎類別實作（60 分鐘）
1. **BankAccount 基礎類別**：
   ```python
   class BankAccount:
       def __init__(self, account_number, initial_balance, customer):
           # 私有屬性設計

       @property
       def balance(self):
           # Property 裝飾器實作

       def deposit(self, amount):
           # 存款業務邏輯

       def withdraw(self, amount):
           # 提款業務邏輯 + 餘額檢查
   ```

2. **Transaction 類別**：交易記錄的資料結構
3. **Customer 類別**：客戶資訊管理

#### 步驟 2.2: 繼承類別實作（90 分鐘）
1. **SavingsAccount**：利息計算、提款限制
2. **CheckingAccount**：透支功能、手續費機制
3. **TimeDepositAccount**：定期存款期限與提前解約
4. **方法覆寫（Override）**：子類別特殊行為的實作

#### 步驟 2.3: 銀行系統整合（30-90 分鐘）
1. **Bank 類別**：
   - 帳戶管理（開戶、銷戶、查詢）
   - 客戶管理（新增、查詢、統計）
   - 系統統計功能
2. **多型應用**：統一介面處理不同帳戶類型
3. **工廠模式**：帳戶類型的動態創建

### Phase 3: 進階功能與測試（120-180 分鐘）

#### 步驟 3.1: 特殊方法實作（60 分鐘）
1. **比較運算子**：帳戶餘額比較 (`__eq__`, `__lt__`, `__gt__`)
2. **字串表示**：友善的輸出格式 (`__str__`, `__repr__`)
3. **運算子重載**：帳戶間轉帳 (`__add__`, `__sub__`)
4. **迭代器模式**：交易記錄遍歷

#### 步驟 3.2: 進階功能實作（選做，60-90 分鐘）
1. **CreditAccount**：信用卡帳戶與信用額度
2. **InvestmentAccount**：投資帳戶與資產管理
3. **利息自動計算**：定期利息派發機制
4. **風險控制**：異常交易偵測

#### 步驟 3.3: 測試與除錯（30-60 分鐘）
1. **功能測試**：各種操作情境的驗證
2. **邊界測試**：極值情況的處理
3. **例外測試**：錯誤處理機制驗證
4. **整合測試**：系統整體運作測試

---

## 🏛️ 核心類別設計（Class Design）

### 1. BankAccount（銀行帳戶基礎類別）

```python
class BankAccount:
    """銀行帳戶基礎類別 - 抽象基礎類別

    封裝所有帳戶共同的屬性與行為
    """
    # 類別變數
    _next_account_number = 100001

    def __init__(self, initial_balance: float, customer: 'Customer'):
        # 私有屬性
        self._account_number = self._generate_account_number()
        self._balance = self._validate_initial_balance(initial_balance)
        self._customer = customer
        self._transactions = []
        self._created_date = datetime.now()
        self._is_active = True

    @property
    def balance(self) -> float:
        """取得帳戶餘額（唯讀）"""

    @property
    def account_number(self) -> str:
        """取得帳戶號碼（唯讀）"""

    def deposit(self, amount: float) -> bool:
        """存款操作"""

    def withdraw(self, amount: float) -> bool:
        """提款操作 - 子類別需覆寫實作特殊邏輯"""

    def get_transaction_history(self) -> List['Transaction']:
        """取得交易記錄"""

    def __str__(self) -> str:
        """友善的字串表示"""

    def __eq__(self, other) -> bool:
        """帳戶相等比較"""
```

### 2. 繼承架構設計

```python
class SavingsAccount(BankAccount):
    """儲蓄帳戶 - 有利息、有提款限制"""

    def __init__(self, initial_balance: float, customer: 'Customer',
                 interest_rate: float = 0.015):
        super().__init__(initial_balance, customer)
        self._interest_rate = interest_rate
        self._monthly_withdrawal_count = 0
        self._withdrawal_limit = 6  # 每月限制提款次數

    def withdraw(self, amount: float) -> bool:
        """覆寫提款邏輯 - 檢查提款次數限制"""

    def calculate_interest(self) -> float:
        """計算利息"""

class CheckingAccount(BankAccount):
    """支票帳戶 - 可透支、有手續費"""

    def __init__(self, initial_balance: float, customer: 'Customer',
                 overdraft_limit: float = 1000.0):
        super().__init__(initial_balance, customer)
        self._overdraft_limit = overdraft_limit
        self._transaction_fee = 10.0

    def withdraw(self, amount: float) -> bool:
        """覆寫提款邏輯 - 允許透支"""
```

### 3. 組合關係設計

```python
class Customer:
    """客戶類別"""

    def __init__(self, customer_id: str, name: str, email: str):
        self._customer_id = customer_id
        self._name = name
        self._email = email
        self._accounts = []  # 客戶可擁有多個帳戶

    def add_account(self, account: BankAccount):
        """新增帳戶"""

    def get_total_balance(self) -> float:
        """取得所有帳戶總餘額"""

class Bank:
    """銀行系統類別"""

    def __init__(self, bank_name: str):
        self._bank_name = bank_name
        self._customers = {}  # customer_id -> Customer
        self._accounts = {}   # account_number -> BankAccount

    def create_customer(self, customer_id: str, name: str, email: str) -> Customer:
        """開立客戶"""

    def create_account(self, customer_id: str, account_type: str,
                      initial_balance: float) -> BankAccount:
        """開立帳戶 - 工廠模式"""
```

---

## ✅ 評分標準（Grading Rubric）

| 項目 | 優秀 (90-100) | 良好 (75-89) | 及格 (60-74) | 不及格 (<60) |
|:-----|:-------------|:------------|:------------|:------------|
| **功能完整性<br>(35%)** | • 所有基本功能完整實作<br>• 進階功能實作 ≥3個<br>• 系統整合運作良好<br>• 無重大功能缺陷 | • 基本功能完整實作<br>• 進階功能實作 1-2個<br>• 系統基本運作正常<br>• 少量次要功能問題 | • 基本功能大部分實作<br>• 無進階功能<br>• 核心功能可運作<br>• 部分功能有問題 | • 基本功能缺失嚴重<br>• 核心功能無法運作<br>• 程式無法正常執行<br>• 功能嚴重不完整 |
| **物件導向設計<br>(25%)** | • 繼承架構設計優秀<br>• 封裝完全正確<br>• 多型應用恰當<br>• 抽象層次分明 | • 繼承架構設計良好<br>• 封裝大致正確<br>• 有多型應用<br>• 抽象概念清楚 | • 有基本繼承設計<br>• 封裝部分正確<br>• 多型應用有限<br>• 抽象概念模糊 | • 繼承設計有重大缺陷<br>• 封裝概念錯誤<br>• 無多型應用<br>• 缺乏抽象思維 |
| **程式碼品質<br>(20%)** | • 程式架構清晰<br>• 命名規範一致<br>• 註解完整清楚<br>• 錯誤處理完善 | • 程式架構合理<br>• 命名大致規範<br>• 有適當註解<br>• 有基本錯誤處理 | • 程式架構可接受<br>• 命名不夠一致<br>• 註解不足<br>• 錯誤處理簡陋 | • 程式架構混亂<br>• 命名不規範<br>• 缺乏註解<br>• 無錯誤處理 |
| **特殊方法應用<br>(10%)** | • 實作 ≥5個特殊方法<br>• 運算子重載恰當<br>• 字串表示完善<br>• 比較邏輯正確 | • 實作 3-4個特殊方法<br>• 有運算子重載<br>• 字串表示良好<br>• 比較邏輯基本正確 | • 實作 1-2個特殊方法<br>• 運算子重載簡單<br>• 字串表示基本<br>• 比較邏輯有問題 | • 未實作特殊方法<br>• 無運算子重載<br>• 字串表示不佳<br>• 比較邏輯錯誤 |
| **創新與延伸<br>(10%)** | • 實作多項進階功能<br>• 有創新設計思維<br>• 系統擴展性佳<br>• 效能考量周到 | • 實作部分進階功能<br>• 有設計巧思<br>• 系統可擴展<br>• 有效能意識 | • 進階功能有限<br>• 設計較保守<br>• 擴展性一般<br>• 效能考量不足 | • 無進階功能<br>• 缺乏設計思維<br>• 系統僵化<br>• 無效能考量 |

### 評分計算方式
```
總分 = 功能完整性(35%) + 物件導向設計(25%) + 程式碼品質(20%) + 特殊方法應用(10%) + 創新與延伸(10%)
```

### 加分項目（最多加分10分）
- **卓越設計模式應用**：工廠模式、策略模式、觀察者模式 (+3分)
- **完整的單元測試**：涵蓋率 ≥80% (+3分)
- **效能優化**：記憶體使用、演算法優化 (+2分)
- **使用者體驗**：友善的互動介面 (+2分)

---

## 🎓 教師指引（Teaching Notes）

### 🎯 評分重點與檢核要點

#### 1. 物件導向四大支柱檢核
- **封裝 (Encapsulation)**：
  - ✅ 是否正確使用私有屬性 (`_attribute`)
  - ✅ 是否實作 property 裝飾器
  - ✅ 是否隱藏內部實作細節

- **繼承 (Inheritance)**：
  - ✅ 是否建立合理的類別階層
  - ✅ 是否正確使用 `super()` 呼叫父類別
  - ✅ 是否避免多重繼承的複雜性

- **多型 (Polymorphism)**：
  - ✅ 是否實作方法覆寫 (Override)
  - ✅ 是否能以統一介面處理不同子類別
  - ✅ 是否善用鴨子型態 (Duck Typing)

- **抽象化 (Abstraction)**：
  - ✅ 是否將共同行為抽象到基礎類別
  - ✅ 是否隱藏複雜的實作細節
  - ✅ 是否提供清晰的公開介面

#### 2. Python 特殊方法評估
- **必須實作**：`__init__`, `__str__`, `__repr__`
- **建議實作**：`__eq__`, `__lt__`, `__hash__`
- **進階實作**：`__add__`, `__sub__`, `__iter__`

#### 3. 程式設計最佳實踐
- **命名規範**：PEP 8 風格指引
- **文件字串**：類別與方法的完整說明
- **型態提示**：使用 Type Hints 提升可讀性
- **例外處理**：自訂例外與適當的錯誤訊息

### 🚨 常見問題與解答

**Q1: 學生常將所有屬性設為公開，如何強調封裝的重要性？**
**A1**: 透過實際例子說明：
- 展示直接修改餘額可能造成的問題
- 說明 property 裝飾器如何提供控制存取的機制
- 強調封裝是為了資料安全與程式維護性

**Q2: 學生難以理解何時使用繼承 vs 組合？**
**A2**: 使用 "is-a" vs "has-a" 關係判斷：
- SavingsAccount **is-a** BankAccount → 使用繼承
- Customer **has-a** BankAccount → 使用組合
- 提供決策樹協助判斷

**Q3: 特殊方法的實作順序建議？**
**A3**: 建議實作順序：
1. `__init__`, `__str__` (基礎)
2. `__repr__`, `__eq__` (除錯與比較)
3. `__lt__`, `__gt__` (排序)
4. `__add__`, `__sub__` (運算子重載)

**Q4: 如何引導學生設計合理的類別架構？**
**A4**: 使用引導式提問：
- "這個類別的主要職責是什麼？"
- "哪些屬性是所有子類別共有的？"
- "哪些行為在不同子類別中會有差異？"

### 📊 評分建議與扣分標準

#### 重大扣分項目 (-10~-20分)
- 程式無法執行或有語法錯誤
- 完全沒有使用繼承或封裝概念
- 資料安全性嚴重缺陷（如餘額可任意修改）

#### 中等扣分項目 (-5~-10分)
- 類別設計不當（如所有功能都在一個類別）
- 缺乏適當的錯誤處理
- 無文件字串或註解嚴重不足

#### 輕微扣分項目 (-1~-5分)
- 命名不符合 PEP 8 規範
- 缺少部分特殊方法實作
- 程式碼重複或效率不佳

### 🕐 時間分配建議

#### 課堂示範時間分配 (3小時)
- **Phase 1**: 需求分析與設計 (45分鐘)
- **Phase 2**: 基礎類別實作示範 (90分鐘)
- **Phase 3**: 繼承與多型示範 (45分鐘)

#### 學生實作時間分配 (課後 6-8小時)
- **設計階段**: 1-2小時
- **實作階段**: 3-4小時
- **測試除錯**: 1-2小時
- **文件整理**: 1小時

---

## 🚀 延伸挑戰（Extension Challenges）

完成基本需求後，可嘗試以下進階挑戰：

### 🎯 Level 1: 功能擴展 (中等難度)
1. **多幣別支援**：實作不同貨幣的帳戶與匯率轉換
2. **帳戶凍結機制**：實作帳戶暫停/恢復功能
3. **交易手續費系統**：不同交易類型的差異化收費
4. **每日交易限額**：實作單日提款/轉帳限額控制

### 🎯 Level 2: 架構優化 (高等難度)
5. **觀察者模式**：帳戶餘額變動時自動通知客戶
6. **策略模式**：利息計算與手續費計算的策略選擇
7. **裝飾器模式**：交易記錄、安全檢查等橫切關注點
8. **單例模式**：確保 Bank 系統的唯一實例

### 🎯 Level 3: 企業級功能 (專家難度)
9. **資料持久化**：將帳戶資料保存至檔案/資料庫
10. **並發安全性**：多執行緒環境下的資料一致性
11. **審計日誌**：完整的操作記錄與追蹤機制
12. **風險控制系統**：異常交易偵測與自動風控

### 🎯 Level 4: 實戰應用 (大師難度)
13. **RESTful API**：提供 Web API 介面
14. **圖形化介面**：使用 tkinter 或 PyQt 開發 GUI
15. **微服務架構**：將系統拆分為多個獨立服務
16. **區塊鏈整合**：實作基於區塊鏈的交易記錄

### 挑戰完成獎勵
- **Level 1 完成**：期末成績加分 2%
- **Level 2 完成**：期末成績加分 3%
- **Level 3 完成**：期末成績加分 5%
- **Level 4 完成**：期末成績加分 8% + 推薦實習機會

---

## 📈 學習評估與反思

### 自我評估檢核表
完成專案後，請誠實評估以下項目：

#### 技術能力 (1-5分，5分為完全掌握)
- [ ] 類別設計與實例化 (__/5)
- [ ] 繼承架構規劃 (__/5)
- [ ] 封裝與資訊隱藏 (__/5)
- [ ] 多型與方法覆寫 (__/5)
- [ ] 特殊方法實作 (__/5)
- [ ] 例外處理機制 (__/5)

#### 軟實力 (1-5分)
- [ ] 問題分析能力 (__/5)
- [ ] 系統架構思維 (__/5)
- [ ] 程式碼組織能力 (__/5)
- [ ] 除錯與測試能力 (__/5)

### 反思問題
1. **最大收穫**：完成此專案後，您對物件導向程式設計有什麼新的理解？
2. **最大挑戰**：在實作過程中遇到的最大困難是什麼？如何克服？
3. **設計決策**：回顧您的類別設計，有哪些地方可以改進？
4. **實戰應用**：這個專案的技術與概念，在實際工作中可能如何應用？

---

**專案難度**：⭐⭐⭐⭐☆ (進階級)
**預計完成時間**：25-35 小時 (課程 + 實作 + 測試)
**建議完成期限**：課程進度第 12-13 週
